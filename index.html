<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>æƒæè¼¸å…¥è³‡æ–™</title>
        <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- html5-qrcode CDN -->
        <script src="https://unpkg.com/html5-qrcode"></script>

        <meta name="description" content="æä¾›å¿«é€Ÿæƒæç”¢å“æ¢ç¢¼ä¸¦è¼¸å…¥è³‡æ–™çš„ç¶²é ï¼Œæ–¹ä¾¿ç®¡ç†ç”¢å“è³‡è¨Šã€‚" />
        <meta name="keywords" content="æ¢ç¢¼æƒæ, ç”¢å“è³‡æ–™, HTML5 QR Code, ç¶²é è¡¨å–®, è³‡æ–™è¼¸å…¥" />
        <meta name="author" content="Rex Lai" />
        <meta name="copyright" content="Â© 2025 Rex Lai" />

        <meta property="og:title" content="æƒæè¼¸å…¥è³‡æ–™" />
        <meta property="og:description" content="é€éæ¢ç¢¼æƒæå¿«é€Ÿè¼¸å…¥ç”¢å“è³‡æ–™ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://ttdragon0722.github.io/haha/" />

    </head>
    <body class="bg-gray-100 min-h-screen flex items-center justify-center">
        <a href="table.html"
            class="fixed bottom-4 right-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full shadow-lg transition">
            ğŸ“„ æŸ¥çœ‹ç´€éŒ„
        </a>
        <!-- Container å°ˆç‚ºæ‰‹æ©Ÿå’Œå¹³æ¿è¨­è¨ˆ -->
        <div
            class="w-full px-4 sm:px-6 md:px-8 max-w-md md:max-w-lg mx-auto bg-white rounded-xl shadow-lg p-6">
            <h1 class="text-2xl font-bold mb-4 text-center">ğŸ“· æƒæè¼¸å…¥è³‡æ–™</h1>

            <!-- é–‹å§‹æƒææŒ‰éˆ• -->
            <button id="start-scan-btn"
                class="mb-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                ğŸ“· å•Ÿå‹•æƒæ
            </button>
            <!-- ç›¸æ©Ÿæƒæå™¨ï¼ˆé è¨­éš±è—ï¼‰ -->
            <div id="reader" class="hidden w-full max-w-sm mx-auto mb-4"></div>
            <!-- è¼¸å…¥æ¡†å€å¡Š -->
            <label class="block mb-2 text-gray-700 font-semibold">ç”¢å“è³‡æ–™</label>
            <input id="product-id" type="text"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4"
                placeholder="å“è™Ÿ" />
            <input id="product-name" type="text"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4"
                placeholder="ç”¢å“åç¨±" />


            <label for="name-select"
                class="block mb-2 text-gray-700 font-semibold">å¡«è¡¨äºº</label>
            <select id="name-select"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4 bg-white text-gray-500"
                onchange="handleSelectChange(this)">
                <option value disabled selected>è«‹é¸æ“‡å¡«è¡¨äºº</option>
                <option value="å¼µä¸‰">å¼µä¸‰</option>
                <option value="æå››">æå››</option>
                <option value="ç‹äº”">ç‹äº”</option>
            </select>

            <!-- å¡«è¡¨äººå„ªåŒ– -->
            <script>
            const select = document.getElementById('name-select');
            const storageKey = 'lastSelectedName';

            // è¼‰å…¥æ™‚å¾ localStorage è®€å–
            window.addEventListener('DOMContentLoaded', () => {
                const saved = localStorage.getItem(storageKey);
                if (saved) {
                select.value = saved;
                select.classList.toggle('text-gray-700', saved !== '');
                }
            });

            // é¸æ“‡æ”¹è®Šæ™‚ï¼Œå­˜å› localStorage ä¸¦æ”¹è®Šæ–‡å­—é¡è‰²
            function handleSelectChange(elem) {
                const val = elem.value;
                localStorage.setItem(storageKey, val);
                elem.classList.toggle('text-gray-700', val !== '');
            }
            </script>

            <!-- é‡é‡æ¬„ä½ -->
            <label for="weight-input"
                class="block mb-2 text-gray-700 font-semibold">è£½ä½œé‡é‡</label>
            <div class="flex space-x-2 mb-4">
                <input id="weight-input" type="number" min="1"
                    class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400"
                    placeholder="è«‹è¼¸å…¥é‡é‡(æ•¸å­—)" />

                <select id="unit-select"
                    class="px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <option value="å…¬æ–¤">å…¬æ–¤</option>
                    <option value="å°æ–¤">å°æ–¤</option>
                </select>
            </div>

            <label for="make-date"
                class="block mb-2 text-gray-700 font-semibold">è£½ä½œæ—¥æœŸ</label>
            <input id="make-date" type="date"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4 bg-white" />
            
            <!-- æ™‚é–“æ‰“åŒ… -->
            <script>
                window.addEventListener("DOMContentLoaded", () => {
                    const dateInput = document.getElementById("make-date");
                    const today = new Date();
                    today.setDate(today.getDate() + 1); // åŠ ä¸€å¤©

                    const yyyy = today.getFullYear();
                    const mm = String(today.getMonth() + 1).padStart(2, '0');
                    const dd = String(today.getDate()).padStart(2, '0');

                    dateInput.value = `${yyyy}-${mm}-${dd}`;
                });
            </script>

            <label for="abnormal-reason"
                class="block mb-2 text-gray-700 font-semibold">
                ç”¢å“ç•°å¸¸åŸå› ï¼ˆé¸å¡«ï¼‰
            </label>
            <textarea id="abnormal-reason" rows="5" placeholder="è«‹è¼¸å…¥ç”¢å“ç•°å¸¸åŸå› ï¼ˆé¸å¡«ï¼‰"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 resize-none">
            </textarea>

            <script>
                let html5QrcodeScanner;
                let scanning = false; // ç‹€æ…‹æ——æ¨™

                document.getElementById("start-scan-btn").addEventListener("click", () => {
                    const btn = document.getElementById("start-scan-btn");
                    const readerElement = document.getElementById("reader");

                    if (!scanning) {
                        // é–‹å§‹æƒæ
                        html5QrcodeScanner = new Html5Qrcode("reader");
                        readerElement.classList.remove("hidden");
                        btn.textContent = "âŒé—œé–‰æƒæ";
                        scanning = true;

                        html5QrcodeScanner.start(
                            { facingMode: "environment" },
                            { fps: 10, qrbox: 250 },
                            (decodedText, decodedResult) => {
                                const parts = decodedText.split("@");
                                if (parts.length >= 2) {
                                    document.getElementById("product-id").value = parts[0];
                                    document.getElementById("product-name").value = parts[1];
                                } else {
                                    alert("QR Code æ ¼å¼éŒ¯èª¤ï¼Œæ‡‰åŒ…å« @ åˆ†éš”çš„å…©æ®µè³‡è¨Š");
                                }

                                // æƒæå®Œæˆå¾Œè‡ªå‹•åœæ­¢ä¸¦é—œé–‰æƒæå™¨
                                html5QrcodeScanner.stop().then(() => {
                                    readerElement.classList.add("hidden");
                                    btn.textContent = "å•Ÿå‹•æƒæ";
                                    scanning = false;
                                });
                            },
                            (errorMessage) => {
                                // æƒæéŒ¯èª¤ç•¥é
                            }
                        );
                    } else {
                        // åœæ­¢æƒæ
                        html5QrcodeScanner.stop().then(() => {
                            readerElement.classList.add("hidden");
                            btn.textContent = "ğŸ“· å•Ÿå‹•æƒæ";
                            scanning = false;
                        }).catch((err) => {
                            console.error("åœæ­¢æƒæå¤±æ•—", err);
                        });
                    }
                });
                </script>
            
            
            <button id="save-btn"
                class="w-full mb-4 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                ğŸ’¾ æ·»åŠ ä¸€ç­†è³‡æ–™
            </button>

            <!-- æ‰“åŒ… -->
            <script>
                document.getElementById("save-btn").addEventListener("click", () => {
                    const productId = document.getElementById("product-id").value.trim();
                    const productName = document.getElementById("product-name").value.trim();
                    const name = document.getElementById("name-select").value.trim();
                    const weight = document.getElementById("weight-input").value.trim();
                    const unit = document.getElementById("unit-select").value.trim();
                    const makeDate = document.getElementById("make-date").value.trim();
                    const abnormalReason = document.getElementById("abnormal-reason").value.trim();

                    // æª¢æŸ¥å¿…å¡«æ¬„ä½
                    if (!productId || !productName || !name || !weight || !unit || !makeDate) {
                        alert("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½");
                        return;
                    }

                    // çµ„æˆä¸€ç­†è³‡æ–™ç‰©ä»¶
                    const newEntry = {
                        å“è™Ÿ: productId,
                        ç”¢å“åç¨±: productName,
                        å¡«è¡¨äºº: name,
                        è£½ä½œé‡é‡: `${weight} ${unit}`,
                        è£½ä½œæ—¥æœŸ: makeDate,
                        ç•°å¸¸åŸå› : abnormalReason || "ï¼ˆç„¡ï¼‰"
                    };

                    // å¾ localStorage ä¸­å–å‡ºåŸæœ¬çš„è³‡æ–™ï¼ˆè‹¥ç„¡å‰‡è¨­ç‚ºç©ºé™£åˆ—ï¼‰
                    const oldData = JSON.parse(localStorage.getItem("formDataList")) || [];

                    // å°‡æ–°è³‡æ–™åŠ å…¥
                    oldData.push(newEntry);

                    // å¯«å› localStorage
                    localStorage.setItem("formDataList", JSON.stringify(oldData));

                    alert("âœ… è³‡æ–™å·²å„²å­˜ï¼");

                    // æ¸…ç©ºæ¬„ä½ï¼ˆè¦–éœ€è¦ä¿ç•™éƒ¨åˆ†æ¬„ä½ï¼‰
                    document.getElementById("product-id").value = "";
                    document.getElementById("product-name").value = "";
                    // select ä¸‹æ‹‰é¸å–®é‡è¨­
                    document.getElementById("name-select").selectedIndex = 0;
                    document.getElementById("weight-input").value = "";
                    document.getElementById("unit-select").selectedIndex = 0;
                    document.getElementById("make-date").value = "";
                    document.getElementById("abnormal-reason").value = "";
                });
                </script>

        </div>

    </body>
</html>
