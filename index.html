<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>æƒæè¼¸å…¥è³‡æ–™</title>
        <!-- Tailwind CDN -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- html5-qrcode CDN -->
        <script src="https://unpkg.com/html5-qrcode"></script>
        
    </head>
    <body class="bg-gray-100 min-h-screen flex items-center justify-center">
        <a href="table.html"
            class="fixed bottom-4 right-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full shadow-lg transition">
            ğŸ“„ æŸ¥çœ‹ç´€éŒ„
        </a>
        <!-- Container å°ˆç‚ºæ‰‹æ©Ÿå’Œå¹³æ¿è¨­è¨ˆ -->
        <div
            class="w-full px-4 sm:px-6 md:px-8 max-w-md md:max-w-lg mx-auto bg-white rounded-xl shadow-lg p-6">
            <h1 class="text-2xl font-bold mb-4 text-center">ğŸ“· æƒæè¼¸å…¥è³‡æ–™</h1>

            <!-- è¼¸å…¥æ¡†å€å¡Š -->
            <label class="block mb-2 text-gray-700 font-semibold">è¼¸å…¥è³‡æ–™</label>
            <input id="scan-input" type="text"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4"
                placeholder="è«‹æƒææˆ–æ‰‹å‹•è¼¸å…¥" />

            <!-- é–‹å§‹æƒææŒ‰éˆ• -->
            <button id="start-scan-btn"
                class="mb-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">
                ğŸ“· å•Ÿå‹•æƒæ
            </button>

            <!-- ç›¸æ©Ÿæƒæå™¨ï¼ˆé è¨­éš±è—ï¼‰ -->
            <div id="reader" class="hidden w-full max-w-sm mx-auto mb-4"></div>

            <label for="name-input"
                class="block mb-2 text-gray-700 font-semibold">å¡«è¡¨äºº</label>
            <input id="name-input" type="text"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4"
                placeholder="è«‹è¼¸å…¥å¡«è¡¨äººå§“å" />

            <!-- æ•¸é‡æ¬„ä½ -->
            <label for="quantity-input"
                class="block mb-2 text-gray-700 font-semibold">æ•¸é‡</label>
            <input id="quantity-input" type="number" min="1"
                class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-400 mb-4"
                placeholder="è«‹è¼¸å…¥æ•¸é‡" />

            <script>
                let html5QrcodeScanner;

                // é»æ“ŠæŒ‰éˆ•å¾Œé¡¯ç¤ºæƒæå™¨
                document.getElementById("start-scan-btn").addEventListener("click", () => {
                    const readerElement = document.getElementById("reader");
                    readerElement.classList.remove("hidden"); // é¡¯ç¤ºæƒæå™¨

                    // åˆå§‹åŒ–æƒæå™¨
                    html5QrcodeScanner = new Html5Qrcode("reader");
                    html5QrcodeScanner.start(
                    { facingMode: "environment" }, // å¾Œé¡é ­
                    { fps: 10, qrbox: 250 },
                    (decodedText, decodedResult) => {
                        // æƒææˆåŠŸæ™‚
                        document.getElementById("scan-input").value = decodedText;
                        html5QrcodeScanner.stop().then(() => {
                        readerElement.classList.add("hidden"); // é—œé–‰æƒæå™¨ä¸¦éš±è—
                        });
                    },
                    (errorMessage) => {
                        // æƒæéŒ¯èª¤ï¼ˆå¯ç•¥éï¼‰
                    }
                    );
                });
                </script>
            <button id="save-btn"
                class="w-full mb-4 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition">
                ğŸ’¾ æ·»åŠ ä¸€ç­†è³‡æ–™
            </button>

            <script>
                document.getElementById("save-btn").addEventListener("click", () => {
                    const name = document.getElementById("name-input").value.trim();
                    const quantity = document.getElementById("quantity-input").value.trim();
                    const scanned = document.getElementById("scan-input").value.trim();

                    if (!name || !quantity || !scanned) {
                    alert("è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½");
                    return;
                    }

                    // çµ„æˆä¸€ç­†è³‡æ–™ç‰©ä»¶
                    const newEntry = {
                    å¡«è¡¨äºº: name,
                    æ•¸é‡: quantity,
                    æƒæè³‡æ–™: scanned
                    };

                    // å¾ localStorage ä¸­å–å‡ºåŸæœ¬çš„è³‡æ–™ï¼ˆè‹¥ç„¡å‰‡è¨­ç‚ºç©ºé™£åˆ—ï¼‰
                    const oldData = JSON.parse(localStorage.getItem("formDataList")) || [];

                    // å°‡æ–°è³‡æ–™åŠ å…¥
                    oldData.push(newEntry);

                    // å¯«å› localStorage
                    localStorage.setItem("formDataList", JSON.stringify(oldData));

                    alert("âœ… è³‡æ–™å·²å„²å­˜ï¼");
                    
                    // å¯é¸ï¼šæ¸…ç©ºæ¬„ä½
                    document.getElementById("name-input").value = "";
                    document.getElementById("quantity-input").value = "";
                    document.getElementById("scan-input").value = "";
                });
                </script>

        </div>

    </body>
</html>
