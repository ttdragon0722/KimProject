<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>表單紀錄列表</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- 引入 SheetJS -->
        <script
            src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    </head>
    <body class="bg-gray-100 min-h-screen p-6">
        <button href="report.html" id="export-btn"
            class="fixed bottom-16 right-4 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-full shadow-lg transition">
            📤 輸出報表
        </button>
        <a href="index.html"
            class="fixed bottom-4 right-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full shadow-lg transition">
            📄 繼續添加
        </a>
        <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-xl p-6">
            <h1 class="text-2xl font-bold mb-6 text-center">📋 表單紀錄清單</h1>

            <div class="overflow-x-auto">
                <table
                    class="min-w-full border text-sm text-left text-gray-600">
                    <thead class="bg-gray-200 text-gray-700 uppercase text-xs">
                        <tr>
                            <th class="px-4 py-3">填表人</th>
                            <th class="px-4 py-3">數量</th>
                            <th class="px-4 py-3">掃描資料</th>
                            <th class="px-4 py-3 text-center">操作</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"
                        class="bg-white divide-y divide-gray-200">
                        <!-- JS 動態插入 -->
                    </tbody>
                </table>
            </div>
        </div>

        <script>
    const tableBody = document.getElementById("table-body");

    // 取得 localStorage 資料
    let data = JSON.parse(localStorage.getItem("formDataList")) || [];

    function renderTable() {
      tableBody.innerHTML = ""; // 先清空
      if (data.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-gray-500">沒有任何資料</td></tr>`;
        return;
      }

      data.forEach((entry, index) => {
        const row = document.createElement("tr");
        row.classList.add("hover:bg-gray-100");

        row.innerHTML = `
          <td class="px-4 py-3">${entry.填表人}</td>
          <td class="px-4 py-3">${entry.數量}</td>
          <td class="px-4 py-3">${entry.掃描資料}</td>
          <td class="px-4 py-3 text-center">
            <button class="text-red-600 hover:underline" onclick="deleteEntry(${index})">刪除</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    function deleteEntry(index) {
      if (confirm("確定要刪除這筆資料嗎？")) {
        data.splice(index, 1);
        localStorage.setItem("formDataList", JSON.stringify(data));
        renderTable();
      }
    }

    renderTable();
  </script>
        <script>
    document.getElementById("export-btn").addEventListener("click", () => {
      // 從 localStorage 取資料
      const data = JSON.parse(localStorage.getItem("formDataList")) || [];
      if (data.length === 0) {
        alert("目前沒有資料可匯出！");
        return;
      }

      // 轉成 SheetJS 支援的格式 (陣列 of 物件)
      // data 本身已經是這種格式，直接用即可

      // 建立工作簿和工作表
      const ws = XLSX.utils.json_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "報表");

      // 產生 Excel 檔案並觸發下載
      XLSX.writeFile(wb, "報表.xlsx");
    });
  </script>

    </body>
</html>
